%% このプログラムについて（2025.9.26 YT）
% 使い方
% このスクリプトを実行すると，グラフウィンドウが出てくるので
% タイトルにある指示に従っていく
% 最後にcsvファイルが生成される
% ※指定した画像ファイルが同じフォルダにある必要がある

% 末尾にはいくつかの解説がある（今回の宿題のヒントでもある）
%% ここからが本体
clear; close all; clc;% まっさらにするおまじない，
%（ -> ワークスペースの話）
%（ -> %の話，ファイルの種別の話，拡張子の話）

% 画像の読み込み
% img = imread('img_1.jpg');% <- ふつうはこうやって使うことが多い
tmp(1).img = imread('img_1.jpg');% （ -> 構造体の話）
tmp(2).img = imread('img_2.jpg');
tmp(3).img = imread('img_3.jpg');

% 表示用のラベル
labels = {'最初に', '2番目に', '3番目に'};
% ( -> 配列とリストの話，インデックスの話)

all_clicked_points = [];% 空の配列として初期化

for imgNum = 1:3% 画像が３枚あるのでその分の繰り返し
  
    figure;% 新しくfitureウィンドウを出す
    imshow(tmp(imgNum).img);% （-> toolboxの話）
    clicked_points = zeros(3, 2);  % クリック位置を格納する配列を初期化
    
    for i=1:3
        % タイトルを更新
        title(['この画像の中で、あなたが', labels{i}, '注目したところをクリックしてください']);
        
        % ユーザーのクリックを待つ
        [x, y] = ginput(1);
        
        % 座標を整数に丸めて保存
        x = round(x);% roundは整数に丸める関数，これぐらいの英単語は知っているべき
        y = round(y);
        clicked_points(i, :) = [x, y];
        % 「:」はその行，または，その列の全部というインデックスの指定の仕方
        % この場合は，i行の全部（2列分）に，xとyをそれぞれ代入するという意味
        
        % 結果をコマンドウィンドウに表示
        fprintf('%sクリックされた座標: x = %d, y = %d\n', labels{i}, x, y);
        
    end
    close;% fitureウィンドウを閉じる
    
    all_clicked_points = [all_clicked_points; clicked_points];% 
end

% 現在時刻を取得して、フォーマットする
timestamp = datestr(now, 'yyyy_mmdd_HHMM');

% ファイル名を作成
filename = [timestamp, '.csv'];

% CSVファイルとして保存
writematrix(all_clicked_points, filename);

% 結果を表示
fprintf('保存しました: %s\n', filename);

%% このプログラムにまつわるetc.

% ---- 作り方
% 
% Matlabで
% img_1.jpg を読み込む
% ウィンドウに画像を表示する
% 図タイトルに「この画像の中で、あなたが最初に注目したところをクリックしてください」と表示
% ユーザーがクリックすると、その画素（x, y）値を取り出す
% というスクリプトを作りたい
% 
% というプロンプトをCopilotに与えた
% 概ね想定通りのコードが出てきたのでそこから加工しながら使うことにした
% （生成AIに盲目的に従っているわけではないというアピール）

% ----「%」の話
% 「%」は１個だと，その行をコメントアウト
% 「%%」とすると，セクションを区切りをつくる
% 大規模プログラムになると，セクションごとに実行していくことがある
% 複数行をまとめてコメントアウトしたいときは？
% 該当行を選択して，「CNTR + R」※Windowsの場合
% 右クリックを推すと，作業とショートカットキーの割り当てが出てくるので自分で確認しておく

% ---- Matlab のファイルの種別
% ファイル冒頭　で
% function myFunction % myFunctionの部分は自分で定義できる
% でプログラムを書き始めると，それは自作の「関数」になる
% そうでないと，「スクリプト」になる
% システム的にはどちらも「.m」ファイル
% 関数の場合は，外から参照もできる
% 最近のMatlabだと，スクリプト内にも自作関数を置けるようになった（はず）

% ----「.m」拡張子
% Matlabのスクリプト/関数の拡張子である「.m」は，
% XCODEでも扱うことが多い
% なので，Macでふつうにダブルクリックしていくと，XCODEが立ち上がることがある
% 右クリックから，アプリケーションを指定して開く
% （と，授業中に執拗に説明しているはず）

% ---- Toolboxの話
% imshow()はimage processing toolboxの関数なので台数制限あり，
% ※Matlabの作業が終わったらアプリケーション終了してもらえると助かる
% みんなでシェアして使おう！

% ---- 構造体の話
% 「.」は構造体をつくるときに使う，
% ここでは，tmpという構造体に img というメンバをぶら下げて，画像データを格納
% 構造体もインデックスを付けて，配列のように運用することもできる
% あとで for で回したいのでそうしている
% 動的に増やしていくやり方は好ましくないとされるが
% まだまだ小規模なデータなので気にしない

% ---- ワークスペースの話
% Matlabのメインウィンドウの右側にはワークスペースには
% 今生成されている変数の一覧等が表示される
% クリックしていくだけで，型や中身が見られるのがMatlabの嬉しいところ
% clearを呼び出すと，ワークスペースがまっさらになるので
% スクリプトAでデータを生成しておいて，スクリプトBで処理をするというときに
% Bの冒頭に clear があると，処理が進まないので注意！

% ---- 配列とリストの違い
% {}はリストを作る，[]は配列を作る
% 配列は，型が揃っていないといけない
% リストは，何でも使えるが，演算処理には使いにくい
% ※適材適所が大事！

% ---- インデックスの話
% リストや配列で特定の要素にアクセスしたいときは，インデックス（何番目か）を付ける
% 例：
% labels{1}% <- '最初に'　が表示される
% Matlabでは，先頭のインデックスが1であることに注意する